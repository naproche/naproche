\documentclass{stex}
\libusepackage{naproche}
\libinput{preamble}
\begin{document}
\begin{smodule}{invertible-maps.ftl}
\importmodule[libraries/foundations]{injections-surjections-bijections.ftl}
\symdef{FUNinv}[args=1]{#1^{\comp{-1}}}
\symdecl*{inverse}
\symdecl*{invertible}
\symdecl*{involutory}
\symdecl*{selfinverse}
\symdecl*{involution}

\begin{sfragment}{Definitions}
  \begin{definition}[forthel,for=inverse]
    Let $f$ be a map.
    An \emph{inverse of $f$} is a map $g$ from $\FUNrange(f)$ to $\Dom(f)$ such that $f(a) \Eq b \Iff g(b) \Eq a$ for all $a \Elem \Dom(f)$ and all $b \Elem \Dom(g)$.
  \end{definition}

  \begin{definition}[forthel,for=invertible]
    Let $f$ be a map.
    $f$ is \emph{invertible} iff $f$ has an inverse.
  \end{definition}

  \begin{lemma}[forthel]
    Let $f$ be a map and $g, g'$ be inverses of $f$.
    Then $g \Eq g'$.
  \end{lemma}
  \begin{proof}[forthel]
    We have $\Dom(g) \Eq \FUNrange(f) \Eq \Dom(g')$.

    Let us show that $g(b) \Eq g'(b)$ for all $b \Elem \FUNrange(f)$.
      Let $b \Elem \FUNrange(f)$.
      Take $a \Eq g'(b)$.
      Then $g(b) \Eq a$ iff $f(a) \Eq b$.
      We have $f(a) \Eq b$ iff $g'(b) \Eq a$.
      Thus $g(b) \Eq g'(b)$.
    End.
  \end{proof}

  \begin{definition}[forthel,for={FUNinv,involutory,selfinverse}]
    Let $f$ be an invertible map.
    $\emph{\FUNinv{f}}$ is the inverse of $f$.
    Let $f$ is \emph{involutory} stand for $f$ is the inverse of $f$.
    Let $f$ is \emph{selfinverse} stand for $f$ is the inverse of $f$.
  \end{definition}
\end{sfragment}

\begin{sfragment}{Basic Properties}
  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $g \FUNfromonto{B}{A}$.
    Then $g$ is the inverse of $f$ iff $g \FUNcomp f \Eq \FUNid{A}$ and $f \FUNcomp g \Eq \FUNid{B}$.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$g$ is the inverse of $f$.}
      We have
      $\Dom(g \FUNcomp f)
        \Eq \Dom(f)
        \Eq A
        \Eq \Dom(\FUNid{A})$.
      For all $a \Elem A$ we have
      $(g \FUNcomp f)(a)
        \Eq g(f(a))
        \Eq a$.
      Hence $g \FUNcomp f \Eq \FUNid{A}$.

      We have
      $\Dom(f \FUNcomp g)
        \Eq \Dom(g)
        \Eq B
        \Eq \Dom(\FUNid{B})$.
      For all $b \Elem B$ we have
      $(f \FUNcomp g)(b)
        \Eq f(g(b))
        \Eq b$.
      Hence $f \FUNcomp g \Eq \FUNid{B}$.
    \end{case}

    \begin{case}{$g \FUNcomp f \Eq \FUNid{A}$ and $f \FUNcomp g \Eq \FUNid{B}$.}
      Then $\Dom(g)
        \Eq B
        \Eq \FUNrange(f)$
      and $\FUNrange(g)
        \Eq A
        \Eq \Dom(f)$.
      Let $a \Elem \Dom(f)$ and $b \Elem \Dom(g)$.
      If $f(a) \Eq b$ then
      $g(b)
        \Eq g(f(a))
        \Eq (g \FUNcomp f)(a)
        \Eq \FUNid{A}(a)
        \Eq a$.
      If $g(b) \Eq a$ then
      $f(a)
        \Eq f(g(b))
        \Eq (f \FUNcomp g)(b)
        \Eq \FUNid{B}(b)
        \Eq b$.
      Hence $f(a) \Eq b$ iff $g(b) \Eq a$.
    \end{case}
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}$ is an invertible surjective map from $B$ onto $A$ such that $\FUNinv{(\FUNinv{f})} \Eq f$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a map from $B$ to $A$.
    Indeed $\FUNrange(f) \Eq B$ and $\Dom(f) \Eq A$.
    $\FUNinv{f}$ is surjective onto $A$.
    Indeed for any $a \Elem A$ we have $\FUNinv{f}(f(a)) \Eq a$.
    $\FUNinv{f}$ is the inverse of $f$.
    Thus $f \FUNcomp \FUNinv{f} \Eq \FUNid{B}$ and $\FUNinv{f} \FUNcomp f \Eq \FUNid{A}$.
    Therefore $f$ is the inverse of $\FUNinv{f}$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $f \FUNcomp \FUNinv{f} \Eq \FUNid{B}$ and $\FUNinv{f} \FUNcomp f \Eq \FUNid{A}$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$ .
    $\FUNinv{f}$ is the inverse of $f$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $a \Elem A$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}(f(a)) \Eq a$.
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNinv{f}(f(a)) \Eq (\FUNinv{f} \FUNcomp f)(a) \Eq \FUNid{A}(a) \Eq a$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $b \Elem B$.
    Assume that $f$ is invertible.
    Then $f(\FUNinv{f}(b)) \Eq b$.
  \end{proposition}
  \begin{proof}[forthel]
    We have
    $f(\FUNinv{f}(b))
      \Eq (f \FUNcomp \FUNinv{f})(b)
      \Eq \FUNid{B}(b)
      \Eq b$.
  \end{proof}

  \symdecl*{invertibility of composition of invertible maps}

  \begin{proposition}[forthel,name=invertibility of composition of invertible maps]
    Let $A, B, C$ be classes and $f \FUNfromonto{A}{B}$ and $g \FUNfromonto{B}{C}$.
    Assume that $f$ and $g$ are invertible.
    Then $g \FUNcomp f$ is invertible and $\FUNinv{g \FUNcomp f} \Eq \FUNinv{f} \FUNcomp \FUNinv{g}$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$.
    $\FUNinv{g}$ is a surjective map from $C$ onto $B$.
    Take $h \Eq \FUNinv{f} \FUNcomp \FUNinv{g}$.
    Then $h$ is a surjective map from $C$ onto $A$ (by \sn{surjectivity of composition of surjections}).
    $g \FUNcomp f$ is a map from $A$ to $C$.

    Let us show that $((g \FUNcomp f) \FUNcomp h) \Eq \FUNid{C}$.
      We have $f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g}) \Eq (f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g}$.
      Indeed $f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g})$ and $(f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g}$ are maps of $C$.
      $f \FUNcomp h$ is a map from $C$ to $B$.
      Hence
      \[  (g \FUNcomp f) \FUNcomp h                           \]
      \[    \Eq g \FUNcomp (f \FUNcomp h)                       \]
      \[    \Eq g \FUNcomp (f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g}))   \]
      \[    \Eq g \FUNcomp ((f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g})   \]
      \[    \Eq g \FUNcomp (\FUNid{B} \FUNcomp \FUNinv{g})            \]
      \[    \Eq g \FUNcomp \FUNinv{g}                            \]
      \[    \Eq \FUNid{C}.                                  \]
    End.

    Let us show that $h \FUNcomp (g \FUNcomp f) \Eq \FUNid{A}$.
      We have $(\FUNinv{f} \FUNcomp \FUNinv{g}) \FUNcomp g \Eq \FUNinv{f} \FUNcomp (\FUNinv{g} \FUNcomp g)$.
      $g \FUNcomp f$ is a map from $A$ to $C$.
      Hence
      \[  h \FUNcomp (g \FUNcomp f)                           \]
      \[    \Eq (h \FUNcomp g) \FUNcomp f                       \]
      \[    \Eq ((\FUNinv{f} \FUNcomp \FUNinv{g}) \FUNcomp g) \FUNcomp f   \]
      \[    \Eq (\FUNinv{f} \FUNcomp (\FUNinv{g} \FUNcomp g)) \FUNcomp f   \]
      \[    \Eq (\FUNinv{f} \FUNcomp \FUNid{B}) \FUNcomp f            \]
      \[    \Eq \FUNinv{f} \FUNcomp f                            \]
      \[    \Eq \FUNid{A}.                                  \]
    End.

    Thus $h$ is the inverse of $g \FUNcomp f$.
    Indeed $g \FUNcomp f$ is a surjective map from $A$ onto $C$ and $h$ is a surjective map from $C$ onto $A$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $X \SETinclude A$.
    Assume that $f$ is invertible.
    Then $f \FUNrest X$ is invertible and $\FUNinv{f\FUNrest X} \Eq \FUNinv{f} \FUNrest (\FUNim{f}{X})$.
  \end{proposition}
  \begin{proof}[forthel]
    $f \FUNrest X$ is a surjective map from $X$ onto $\FUNim{f}{X}$.
    Take $g \Eq \FUNinv{f} \FUNrest (\FUNim{f}{X})$.
    Then $g$ is a map of $\FUNim{f}{X}$.

    Let us show that $X \SETinclude \FUNrange(g)$.
      Let $a \Elem X$.
      Then $f(a) \Elem \FUNim{f}{X}$.
      Hence $g(f(a)) \Eq \FUNinv{f}(f(a)) \Eq a$.
      Thus $a$ is a value of $g$.
    End.

    Let us show that $\FUNrange(g) \SETinclude X$.
      Let $a \Elem \FUNrange(g)$.
      Take $b \Elem \FUNim{f}{X}$ such that $a \Eq g(b)$.
      Take $c \Elem X$ such that $b \Eq f(c)$.
      Then $a
        \Eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(b)
        \Eq \FUNinv{f}(b)
        \Eq \FUNinv{f}(f(c))
        \Eq c$.
      Hence $a \Elem X$.
    End.

    Hence $\FUNrange(g) \Eq X$.
    Thus $g$ is a surjective map onto $X$.

    Let us show that $g((f \FUNrest X)(a)) \Eq a$ for all $a \Elem X$.
      Let $a \Elem X$.
      Then $g((f \FUNrest X)(a))
        \Eq g(f(a))
        \Eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(f(a))
        \Eq \FUNinv{f}(f(a))
        \Eq a$.
    End.

    Let us show that $((f \FUNrest X)(g(b))) \Eq b$ for all $b \Elem \FUNim{f}{X}$.
      Let $b \Elem \FUNim{f}{X}$.
      Take $a \Elem X$ such that $b \Eq f(a)$.
      We have $g(b)
        \Eq g(f(a))
        \Eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(f(a))
        \Eq \FUNinv{f}(f(a))
        \Eq a$.
      Hence $(f \FUNrest X)(g(b))
        \Eq (f \FUNrest X)(a)
        \Eq f(a)
        \Eq b$.
    End.

    Thus $g \FUNcomp (f \FUNrest X) \Eq \FUNid{X}$ and $(f \FUNrest X) \FUNcomp g \Eq \FUNid{\FUNim{f}{X}}$.
    Therefore $g$ is the inverse of $f \FUNrest X$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $Y \SETinclude B$.
    Assume that $f$ is invertible.
    Then \[ \FUNpreim{f}{Y} \Eq \FUNim{\FUNinv{f}}{Y}. \]
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNim{\FUNinv{f}}{Y} \Eq \CClass{\FUNinv{f}(b)}{b \Elem Y}$ and $\FUNpreim{f}{Y} \Eq \SClass{a}{A}{f(a) \Elem Y}$.

    Let us show that $\FUNpreim{f}{Y} \SETinclude \FUNim{\FUNinv{f}}{Y}$.
      Let $a \Elem \FUNpreim{f}{Y}$.
      Take $b \Elem Y$ such that $b \Eq f(a)$.
      Then $\FUNinv{f}(b) \Eq \FUNinv{f}(f(a)) \Eq a$.
      Hence $a \Elem \FUNim{\FUNinv{f}}{Y}$.
    End.

    Let us show that $\FUNim{\FUNinv{f}}{Y} \SETinclude \FUNpreim{f}{Y}$.
      Let $a \Elem \FUNim{\FUNinv{f}}{Y}$.
      Take $b \Elem Y$ such that $a \Eq \FUNinv{f}(b)$.
      Then $f(a) \Eq f(\FUNinv{f}(b)) \Eq b$.
      Hence $a \Elem \FUNpreim{f}{Y}$.
    End.
  \end{proof}

  \begin{corollary}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $b \Elem B$.
    Assume that $f$ is invertible.
    Then \[ \FUNpreim{f}{\SETsingleton{b}} \Eq \SETsingleton{\FUNinv{f}(b)}. \]
  \end{corollary}
  \begin{proof}[forthel]
    $\FUNpreim{f}{\SETsingleton{b}} \Eq \FUNim{\FUNinv{f}}{\SETsingleton{b}}$.
    We have $\FUNim{\FUNinv{f}}{\SETsingleton{b}} \Eq \CClass{\FUNinv{f}(c)}{c \Elem \SETsingleton{b}}$.
    Hence $\FUNim{\FUNinv{f}}{\SETsingleton{b}} \Eq \SETsingleton{\FUNinv{f}(b)}$.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Then $f$ is invertible iff $f$ is injective.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$f$ is invertible.}
      Let $a, b \Elem A$.
      Assume $f(a) \Eq f(b)$.
      Then $a \Eq \FUNinv{f}(f(a)) \Eq \FUNinv{f}(f(b)) \Eq b$.
    \end{case}

    \begin{case}{$f$ is injective.}
      Define $g(b) \DefEq$ ``choose $a \Elem A$ such that $f(a) \Eq b$ in $a$'' for
      $b \Elem B$.
      Then $g$ is a map from $B$ to $A$.
      For all $a \Elem A$ we have $a \Eq g(f(a))$.
      Hence $g$ is a surjective map from $B$ onto $A$.
      For all $a \Elem A$ we have $g(f(a)) \Eq a$.
      For all $b \Elem B$ we have $f(g(b)) \Eq b$.
      Hence $g$ is the inverse of $f$.
    \end{case}
  \end{proof}

  \begin{corollary}[forthel]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}$ is a bijection between $B$ and $A$.
  \end{corollary}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$.
    $\FUNinv{f}$ is invertible.
    Hence $\FUNinv{f}$ is injective.
    Therefore $\FUNinv{f}$ is a bijection between $B$ and $A$.
  \end{proof}
\end{sfragment}

\begin{sfragment}{Involutions}
  \begin{definition}[forthel,for=involution]
    Let $A$ be a class.
    An \emph{involution on $A$} is a selfinverse map $f$ on $A$.
  \end{definition}

  \begin{proposition}[forthel]
    Let $A$ be a class.
    $\FUNid{A}$ is an involution on $A$.
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNid{A} \FUNcomp \FUNid{A} \Eq \FUNid{A}$.
    Hence $\FUNid{A}$ is selfinverse.
  \end{proof}

  \begin{proposition}[forthel]
    Let $A$ be a class and $f, g$ be involutions on $A$.
    Then $g \FUNcomp f$ is an involution on $A$ iff $g \FUNcomp f \Eq f \FUNcomp g$.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$g \FUNcomp f$ is an involution on $A$.}
      Then $\FUNinv{g \FUNcomp f}
        \Eq \FUNinv{f} \FUNcomp \FUNinv{g}
        \Eq f \FUNcomp g$
      (by \sn{invertibility of composition of invertible maps}).
      Indeed $f$ and $g$ are invertible and surjective onto $A$.
    \end{case}

    \begin{case}{$g \FUNcomp f \Eq f \FUNcomp g$.}
      [prover vampire]
      $f \FUNcomp f$, $f \FUNcomp g$ and $f \FUNcomp g$ are maps on $A$.
      Hence
      \[  (g \FUNcomp f) \FUNcomp (g \FUNcomp f)       \]
      \[    \Eq (g \FUNcomp f) \FUNcomp (f \FUNcomp g)   \]
      \[    \Eq ((g \FUNcomp f) \FUNcomp f) \FUNcomp g   \]
      \[    \Eq (g \FUNcomp (f \FUNcomp f)) \FUNcomp g   \]
      \[    \Eq (g \FUNcomp \FUNid{A}) \FUNcomp g       \]
      \[    \Eq g \FUNcomp g                       \]
      \[    \Eq \FUNid{A}.                        \]
      Thus $g \FUNcomp f$ is selfinverse.
    \end{case}
  \end{proof}

  \begin{corollary}[forthel]
    Let $A$ be a class and $f$ be an involutions on $A$.
    Then $f \FUNcomp f$ is an involution on $A$.
  \end{corollary}

  \begin{proposition}[forthel]
    Let $A$ be a class and $f$ be an involution on $A$.
    Then $f$ is a permutation of $A$.
  \end{proposition}
  \begin{proof}[forthel]
    $f$ is an invertible map of $A$ that surjects onto $A$.
    Hence $f$ is a bijection between $A$ and $A$.
    Thus $f$ is a permutation of $A$.
  \end{proof}
\end{sfragment}
\end{smodule}
\end{document}

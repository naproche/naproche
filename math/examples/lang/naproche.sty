\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{naproche}[2025/03/08 package naproche]

\RequirePackage[english]{babel}
\RequirePackage{amsmath,amssymb,amsfonts}
\RequirePackage{xspace}
\RequirePackage{xcolor}
\RequirePackage{mdframed}
\RequirePackage{xurl}
\RequirePackage{hyperref}

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=blue
}


% Predefined symbols
% ------------------

\NewDocumentCommand{\dom}{}{\operatorname{dom}}
\NewDocumentCommand{\fun}{}{\mathrm{\lambda}}


% Naproche logo
% -------------

\NewDocumentCommand{\Naproche}{}{\mbox{\ensuremath{\mathbb{N}}aproche}\xspace}


% Comprehension terms
% -------------------

\RequirePackage{linegoal}

\NewDocumentCommand{\lproj}{m m}{#1}
\NewDocumentCommand{\rproj}{m m}{#2}

\NewDocumentCommand{\class}{>{\SplitArgument{1}{|}} m}{
  \left\{\lproj#1~\middle\vert~\rproj#1\right\}
}

\NewDocumentCommand{\classtext}{m}{\parbox{\linegoal}{#1}}


% Printing labels
% ---------------

\NewDocumentCommand{\printref}{m}{\path{#1}}


% Top-level sections
% ------------------

\newcounter{tlscounter}

\NewDocumentCommand{\NewTopLevelSection}{s m m}{
  \NewDocumentEnvironment{#2\IfBooleanT{#1}{*}}{o}{
    \IfBooleanF{#1}{\refstepcounter{tlscounter}}
    \par
    \ifbool{forthel}{}{\vspace{0.5em}}
    \noindent\textbf{#3\IfBooleanF{#1}{~\thetlscounter}\IfValueT{##1}{~(##1)}.}%
    \normalfont%
  }{
    \par
    \ifbool{forthel}{}{\vspace{0.5em}}
  }
}

\NewTopLevelSection{signature}{Signature}
\NewTopLevelSection*{signature}{Signature}

\NewTopLevelSection{definition}{Definition}
\NewTopLevelSection*{definition}{Definition}

\NewTopLevelSection{axiom}{Axiom}
\NewTopLevelSection*{axiom}{Axiom}

\NewTopLevelSection{theorem}{Theorem}
\NewTopLevelSection*{theorem}{Theorem}

\NewTopLevelSection{lemma}{Lemma}
\NewTopLevelSection*{lemma}{Lemma}

\NewTopLevelSection{proposition}{Proposition}
\NewTopLevelSection*{proposition}{Proposition}

\NewTopLevelSection{corollary}{Corollary}
\NewTopLevelSection*{corollary}{Corollary}

\NewTopLevelSection{convention}{Convention}
\NewTopLevelSection*{convention}{Convention}


% ForTheL environment
% -------------------

\newbool{forthel}

\NewDocumentEnvironment{forthel}{}{
  \begin{mdframed}[backgroundcolor=lightgray!30, linecolor=lightgray!30]
  \setbool{forthel}{true}
  \setlength{\parindent}{0pt}
  \setlength{\parskip}{0.5em}
}{
  \end{mdframed}
  \setbool{forthel}{false}
}


% Proof Environment
% -----------------

\NewDocumentEnvironment{proof}{o}{
  \par
  \ifbool{forthel}{}{\vspace{0.5em}}
  \noindent\textit{Proof\IfValueT{#1}{~#1}.}%
}
{
  \hfill\ensuremath{\square}
  \par
}


% Package Options
% ---------------

\DeclareOption{numberswithinsection}{%
  \counterwithin{tlscount}{section}
}
\DeclareOption{numberswithinsubsection}{%
  \counterwithin{tlscount}{subsection}
}
\DeclareOption*{\PackageWarning{naproche}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax

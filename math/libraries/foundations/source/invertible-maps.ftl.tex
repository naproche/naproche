\documentclass{naproche-library}
\libinput{preamble}
\begin{document}
\IfInputref{}{\setsectionlevel{section}}
\begin{smodule}[title=Invertible Maps]{invertible-maps.ftl}
\importmodule[libraries/foundations]{injections-surjections-bijections.ftl}
\symdef{FUNinv}[args=1]{#1^{\comp{-1}}}

\begin{sfragment}{Definitions}
  \inlineforthel{[synonym inverse/-s]}

  \begin{definition}[forthel,id=FOUNDATIONS_09_7776974319648768]
    Let $f$ be a map.
    An \emph{inverse of $f$} is a map $g$ from $\FUNrange(f)$ to $\dom(f)$ such that $f(a) \eq b \iff g(b) \eq a$ for all $a \in \dom(f)$ and all $b \in \dom(g)$.
  \end{definition}

  \begin{definition}[forthel,id=FOUNDATIONS_09_3430350086733824]
    Let $f$ be a map.
    $f$ is \emph{invertible} iff $f$ has an inverse.
  \end{definition}

  \begin{lemma}[forthel,id=FOUNDATIONS_09_5108611793551360]
    Let $f$ be a map and $g, g'$ be inverses of $f$.
    Then $g \eq g'$.
  \end{lemma}
  \begin{proof}[forthel]
    We have $\dom(g) \eq \FUNrange(f) \eq \dom(g')$.

    Let us show that $g(b) \eq g'(b)$ for all $b \in \FUNrange(f)$.
      Let $b \in \FUNrange(f)$.
      Take $a = g'(b)$.
      Then $g(b) \eq a$ iff $f(a) \eq b$.
      We have $f(a) \eq b$ iff $g'(b) \eq a$.
      Thus $g(b) \eq g'(b)$.
    End.
  \end{proof}

  \begin{definition}[forthel,id=FOUNDATIONS_09_6458627204317184]
    Let $f$ be an invertible map.
    $\emph{\FUNinv{f}}$ is the inverse of $f$.

    Let $f$ is \emph{involutory} stand for $f$ is the inverse of $f$.
    Let $f$ is \emph{selfinverse} stand for $f$ is the inverse of $f$.
  \end{definition}
\end{sfragment}

\begin{sfragment}{Basic Properties}
  \begin{proposition}[forthel,id=FOUNDATIONS_09_7840743571849216]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $g \FUNfromonto{B}{A}$.
    Then $g$ is the inverse of $f$ iff $g \FUNcomp f \eq \FUNid{A}$ and $f \FUNcomp g \eq \FUNid{B}$.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$g$ is the inverse of $f$.}
      We have
      $\dom(g \FUNcomp f)
        \eq \dom(f)
        \eq A
        \eq \dom(\FUNid{A})$.
      For all $a \in A$ we have
      $(g \FUNcomp f)(a)
        \eq g(f(a))
        \eq a$.
      Hence $g \FUNcomp f \eq \FUNid{A}$.

      We have
      $\dom(f \FUNcomp g)
        \eq \dom(g)
        \eq B
        \eq \dom(\FUNid{B})$.
      For all $b \in B$ we have
      $(f \FUNcomp g)(b)
        \eq f(g(b))
        \eq b$.
      Hence $f \FUNcomp g \eq \FUNid{B}$.
    \end{case}

    \begin{case}{$g \FUNcomp f \eq \FUNid{A}$ and $f \FUNcomp g \eq \FUNid{B}$.}
      Then $\dom(g)
        \eq B
        \eq \FUNrange(f)$
      and $\FUNrange(g)
        \eq A
        \eq \dom(f)$.
      Let $a \in \dom(f)$ and $b \in \dom(g)$.
      If $f(a) \eq b$ then
      $g(b)
        \eq g(f(a))
        \eq (g \FUNcomp f)(a)
        \eq \FUNid{A}(a)
        \eq a$.
      If $g(b) \eq a$ then
      $f(a)
        \eq f(g(b))
        \eq (f \FUNcomp g)(b)
        \eq \FUNid{B}(b)
        \eq b$.
      Hence $f(a) \eq b$ iff $g(b) \eq a$.
    \end{case}
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_8414736098000896]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}$ is an invertible surjective map from $B$ onto $A$ such that $\FUNinv{(\FUNinv{f})} \eq f$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a map from $B$ to $A$.
    Indeed $\FUNrange(f) \eq B$ and $\dom(f) \eq A$.
    $\FUNinv{f}$ is surjective onto $A$.
    Indeed for any $a \in A$ we have $\FUNinv{f}(f(a)) \eq a$.
    $\FUNinv{f}$ is the inverse of $f$.
    Thus $f \FUNcomp \FUNinv{f} \eq \FUNid{B}$ and $\FUNinv{f} \FUNcomp f \eq \FUNid{A}$.
    Therefore $f$ is the inverse of $\FUNinv{f}$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_4577560740495360]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $f \FUNcomp \FUNinv{f} \eq \FUNid{B}$ and $\FUNinv{f} \FUNcomp f \eq \FUNid{A}$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$ .
    $\FUNinv{f}$ is the inverse of $f$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_4606651604664320]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $a \in A$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}(f(a)) \eq a$.
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNinv{f}(f(a)) \eq (\FUNinv{f} \FUNcomp f)(a) \eq \FUNid{A}(a) \eq a$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_6093864386712935]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $b \in B$.
    Assume that $f$ is invertible.
    Then $f(\FUNinv{f}(b)) \eq b$.
  \end{proposition}
  \begin{proof}[forthel]
    We have
    $f(\FUNinv{f}(b))
      \eq (f \FUNcomp \FUNinv{f})(b)
      \eq \FUNid{B}(b)
      \eq b$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_7619151963095040]
    Let $A, B, C$ be classes and $f \FUNfromonto{A}{B}$ and $g \FUNfromonto{B}{C}$.
    Assume that $f$ and $g$ are invertible.
    Then $g \FUNcomp f$ is invertible and $\FUNinv{g \FUNcomp f} \eq \FUNinv{f} \FUNcomp \FUNinv{g}$.
  \end{proposition}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$.
    $\FUNinv{g}$ is a surjective map from $C$ onto $B$.
    Take $h = \FUNinv{f} \FUNcomp \FUNinv{g}$.
    Then $h$ is a surjective map from $C$ onto $A$ (by \printref{FOUNDATIONS_08_8542698338254848}).
    $g \FUNcomp f$ is a map from $A$ to $C$.

    Let us show that $((g \FUNcomp f) \FUNcomp h) \eq \FUNid{C}$.
      We have $f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g}) \eq (f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g}$.
      Indeed $f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g})$ and $(f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g}$ are maps of $C$.
      $f \FUNcomp h$ is a map from $C$ to $B$.
      Hence
      \[  (g \FUNcomp f) \FUNcomp h                           \]
      \[    \eq g \FUNcomp (f \FUNcomp h)                       \]
      \[    \eq g \FUNcomp (f \FUNcomp (\FUNinv{f} \FUNcomp \FUNinv{g}))   \]
      \[    \eq g \FUNcomp ((f \FUNcomp \FUNinv{f}) \FUNcomp \FUNinv{g})   \]
      \[    \eq g \FUNcomp (\FUNid{B} \FUNcomp \FUNinv{g})            \]
      \[    \eq g \FUNcomp \FUNinv{g}                            \]
      \[    \eq \FUNid{C}.                                  \]
    End.

    Let us show that $h \FUNcomp (g \FUNcomp f) \eq \FUNid{A}$.
      We have $(\FUNinv{f} \FUNcomp \FUNinv{g}) \FUNcomp g \eq \FUNinv{f} \FUNcomp (\FUNinv{g} \FUNcomp g)$.
      $g \FUNcomp f$ is a map from $A$ to $C$.
      Hence
      \[  h \FUNcomp (g \FUNcomp f)                           \]
      \[    \eq (h \FUNcomp g) \FUNcomp f                       \]
      \[    \eq ((\FUNinv{f} \FUNcomp \FUNinv{g}) \FUNcomp g) \FUNcomp f   \]
      \[    \eq (\FUNinv{f} \FUNcomp (\FUNinv{g} \FUNcomp g)) \FUNcomp f   \]
      \[    \eq (\FUNinv{f} \FUNcomp \FUNid{B}) \FUNcomp f            \]
      \[    \eq \FUNinv{f} \FUNcomp f                            \]
      \[    \eq \FUNid{A}.                                  \]
    End.

    Thus $h$ is the inverse of $g \FUNcomp f$.
    Indeed $g \FUNcomp f$ is a surjective map from $A$ onto $C$ and $h$ is a surjective map from $C$ onto $A$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_6374884963778560]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $X \SETinclude A$.
    Assume that $f$ is invertible.
    Then $f \FUNrest X$ is invertible and $\FUNinv{f\FUNrest X} \eq \FUNinv{f} \FUNrest (\FUNim{f}{X})$.
  \end{proposition}
  \begin{proof}[forthel]
    $f \FUNrest X$ is a surjective map from $X$ onto $\FUNim{f}{X}$.
    Take $g = \FUNinv{f} \FUNrest (\FUNim{f}{X})$.
    Then $g$ is a map of $\FUNim{f}{X}$.

    Let us show that $X \SETinclude \FUNrange(g)$.
      Let $a \in X$.
      Then $f(a) \in \FUNim{f}{X}$.
      Hence $g(f(a)) \eq \FUNinv{f}(f(a)) \eq a$.
      Thus $a$ is a value of $g$.
    End.

    Let us show that $\FUNrange(g) \SETinclude X$.
      Let $a \in \FUNrange(g)$.
      Take $b \in \FUNim{f}{X}$ such that $a \eq g(b)$.
      Take $c \in X$ such that $b \eq f(c)$.
      Then $a
        \eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(b)
        \eq \FUNinv{f}(b)
        \eq \FUNinv{f}(f(c))
        \eq c$.
      Hence $a \in X$.
    End.

    Hence $\FUNrange(g) \eq X$.
    Thus $g$ is a surjective map onto $X$.

    Let us show that $g((f \FUNrest X)(a)) \eq a$ for all $a \in X$.
      Let $a \in X$.
      Then $g((f \FUNrest X)(a))
        \eq g(f(a))
        \eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(f(a))
        \eq \FUNinv{f}(f(a))
        \eq a$.
    End.

    Let us show that $((f \FUNrest X)(g(b))) \eq b$ for all $b \in \FUNim{f}{X}$.
      Let $b \in \FUNim{f}{X}$.
      Take $a \in X$ such that $b \eq f(a)$.
      We have $g(b)
        \eq g(f(a))
        \eq (\FUNinv{f} \FUNrest (\FUNim{f}{X}))(f(a))
        \eq \FUNinv{f}(f(a))
        \eq a$.
      Hence $(f \FUNrest X)(g(b))
        \eq (f \FUNrest X)(a)
        \eq f(a)
        \eq b$.
    End.

    Thus $g \FUNcomp (f \FUNrest X) \eq \FUNid{X}$ and $(f \FUNrest X) \FUNcomp g \eq \FUNid{\FUNim{f}{X}}$.
    Therefore $g$ is the inverse of $f \FUNrest X$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_7726021377785856]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $Y \SETinclude B$.
    Assume that $f$ is invertible.
    Then \[ \FUNpreim{f}{Y} \eq \FUNim{\FUNinv{f}}{Y}. \]
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNim{\FUNinv{f}}{Y} = \{ \FUNinv{f}(b) \mid b \in Y \}$ and $\FUNpreim{f}{Y} = \{ a \in A \mid f(a) \in Y \}$.

    Let us show that $\FUNpreim{f}{Y} \SETinclude \FUNim{\FUNinv{f}}{Y}$.
      Let $a \in \FUNpreim{f}{Y}$.
      Take $b \in Y$ such that $b \eq f(a)$.
      Then $\FUNinv{f}(b) \eq \FUNinv{f}(f(a)) \eq a$.
      Hence $a \in \FUNim{\FUNinv{f}}{Y}$.
    End.

    Let us show that $\FUNim{\FUNinv{f}}{Y} \SETinclude \FUNpreim{f}{Y}$.
      Let $a \in \FUNim{\FUNinv{f}}{Y}$.
      Take $b \in Y$ such that $a \eq \FUNinv{f}(b)$.
      Then $f(a) \eq f(\FUNinv{f}(b)) \eq b$.
      Hence $a \in \FUNpreim{f}{Y}$.
    End.
  \end{proof}

  \begin{corollary}[forthel,id=FOUNDATIONS_09_8607784268464128]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$ and $b \in B$.
    Assume that $f$ is invertible.
    Then \[ \FUNpreim{f}{\SETsingleton{b}} \eq \SETsingleton{\FUNinv{f}(b)}. \]
  \end{corollary}
  \begin{proof}[forthel]
    $\FUNpreim{f}{\SETsingleton{b}} \eq \FUNim{\FUNinv{f}}{\SETsingleton{b}}$.
    We have $\FUNim{\FUNinv{f}}{\SETsingleton{b}} = \{ \FUNinv{f}(c) \mid c \in \SETsingleton{b} \}$.
    Hence $\FUNim{\FUNinv{f}}{\SETsingleton{b}} \eq \SETsingleton{\FUNinv{f}(b)}$.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_6777575974109184]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Then $f$ is invertible iff $f$ is injective.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$f$ is invertible.}
      Let $a, b \in A$.
      Assume $f(a) \eq f(b)$.
      Then $a \eq \FUNinv{f}(f(a)) \eq \FUNinv{f}(f(b)) \eq b$.
    \end{case}

    \begin{case}{$f$ is injective.}
      Define $g(b) =$ ``choose $a \in A$ such that $f(a) \eq b$ in $a$'' for
      $b \in B$.
      Then $g$ is a map from $B$ to $A$.
      For all $a \in A$ we have $a \eq g(f(a))$.
      Hence $g$ is a surjective map from $B$ onto $A$.
      For all $a \in A$ we have $g(f(a)) \eq a$.
      For all $b \in B$ we have $f(g(b)) \eq b$.
      Hence $g$ is the inverse of $f$.
    \end{case}
  \end{proof}

  \begin{corollary}[forthel,id=FOUNDATIONS_09_5708971514003456]
    Let $A, B$ be classes and $f \FUNfromonto{A}{B}$.
    Assume that $f$ is invertible.
    Then $\FUNinv{f}$ is a bijection between $B$ and $A$.
  \end{corollary}
  \begin{proof}[forthel]
    $\FUNinv{f}$ is a surjective map from $B$ onto $A$.
    $\FUNinv{f}$ is invertible.
    Hence $\FUNinv{f}$ is injective.
    Therefore $\FUNinv{f}$ is a bijection between $B$ and $A$.
  \end{proof}
\end{sfragment}

\begin{sfragment}{Involutions}
  \inlineforthel{[synonym involution/-s]}

  \begin{definition}[forthel,id=FOUNDATIONS_09_7282039688527872]
    Let $A$ be a class.
    An \emph{involution on $A$} is a selfinverse map $f$ on $A$.
  \end{definition}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_7944474185433088]
    Let $A$ be a class.
    $\FUNid{A}$ is an involution on $A$.
  \end{proposition}
  \begin{proof}[forthel]
    We have $\FUNid{A} \FUNcomp \FUNid{A} \eq \FUNid{A}$.
    Hence $\FUNid{A}$ is selfinverse.
  \end{proof}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_6897019612299264]
    Let $A$ be a class and $f, g$ be involutions on $A$.
    Then $g \FUNcomp f$ is an involution on $A$ iff $g \FUNcomp f \eq f \FUNcomp g$.
  \end{proposition}
  \begin{proof}[forthel]
    \begin{case}{$g \FUNcomp f$ is an involution on $A$.}
      Then $\FUNinv{g \FUNcomp f}
        \eq \FUNinv{f} \FUNcomp \FUNinv{g}
        \eq f \FUNcomp g$
      (by \printref{FOUNDATIONS_09_7619151963095040}).
      Indeed $f$ and $g$ are invertible and surjective onto $A$.
    \end{case}

    \begin{case}{$g \FUNcomp f \eq f \FUNcomp g$.}
      $f \FUNcomp f$, $f \FUNcomp g$ and $f \FUNcomp g$ are maps on $A$.
      Hence
      \[  (g \FUNcomp f) \FUNcomp (g \FUNcomp f)       \]
      \[    \eq (g \FUNcomp f) \FUNcomp (f \FUNcomp g)   \]
      \[    \eq ((g \FUNcomp f) \FUNcomp f) \FUNcomp g   \]
      \[    \eq (g \FUNcomp (f \FUNcomp f)) \FUNcomp g   \]
      \[    \eq (g \FUNcomp \FUNid{A}) \FUNcomp g       \]
      \[    \eq g \FUNcomp g                       \]
      \[    \eq \FUNid{A}.                        \]
      Thus $g \FUNcomp f$ is selfinverse.
    \end{case}
  \end{proof}

  \begin{corollary}[forthel,id=FOUNDATIONS_09_5958206868160512]
    Let $A$ be a class and $f$ be an involutions on $A$.
    Then $f \FUNcomp f$ is an involution on $A$.
  \end{corollary}

  \begin{proposition}[forthel,id=FOUNDATIONS_09_2314262743613440]
    Let $A$ be a class and $f$ be an involution on $A$.
    Then $f$ is a permutation of $A$.
  \end{proposition}
  \begin{proof}[forthel]
    $f$ is an invertible map of $A$ that surjects onto $A$.
    Hence $f$ is a bijection between $A$ and $A$.
    Thus $f$ is a permutation of $A$.
  \end{proof}
\end{sfragment}
\end{smodule}
\end{document}
